<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KPI de Vacantes</title>
</head>
<body>
  <h1>Indicadores de Vacantes</h1>
  <div id="kpi"></div>

  <script type="module">
    import { db } from "./js/firebase-config.js";
    import { collection, getDocs } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    async function calcularKPI() {
      const entrevistasSnap = await getDocs(collection(db, 'entrevistas'));
      let abiertos = 0, proceso = 0, cerrados = 0;
      entrevistasSnap.forEach(doc => {
        const estatus = doc.data().estatus;
        if (estatus === 'Abierto') abiertos++;
        else if (estatus === 'En proceso') proceso++;
        else if (estatus === 'Cerrado') cerrados++;
      });

      const vacantesSnap = await getDocs(collection(db, 'vacantes'));
      let totalVacantes = 0;
      vacantesSnap.forEach(doc => {
        totalVacantes += Number(doc.data().vacantes);
      });

      const sinCubrir = totalVacantes - cerrados;
      const contenedor = document.getElementById('kpi');
      contenedor.innerHTML = `
        <p>Vacantes totales declaradas: ${totalVacantes}</p>
        <p>Tickets abiertos: ${abiertos}</p>
        <p>Tickets en proceso: ${proceso}</p>
        <p>Tickets cerrados: ${cerrados}</p>
        <p>Vacantes sin cubrir: ${sinCubrir}</p>
      `;

      if (sinCubrir > 10) {
        const alerta = document.createElement('p');
        alerta.style.color = 'red';
        alerta.textContent = 'Alerta: hay muchas vacantes sin cubrir';
        contenedor.appendChild(alerta);
      }
    }

    calcularKPI();
  </script>
</body>
</html>
